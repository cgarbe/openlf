<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>OpenLF: OpenLF Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OpenLF
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="classOpenLF.html">OpenLF</a> Tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial will show you how to create a simple component with one input and one output and two settings, giving an introduction into <a class="el" href="classOpenLF.html">OpenLF</a> and its parts and concepts. The component will simply read the settings and store a string into the output lightfield dataset at the specified position.</p>
<h2>Header</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef _OPENLF_COMP_TUTORIAL_H</span></div>
<div class="line"><span class="preprocessor">#define _OPENLF_COMP_TUTORIAL_H</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;dspatch/DspComponent.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceopenlf.html">openlf</a> { <span class="keyword">namespace </span>components {</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>COMP_Tutorial : <span class="keyword">public</span> DspComponent {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  COMP_Tutorial();</div>
<div class="line">  DSPCOMPONENT_TRIVIAL_CLONE(COMP_Tutorial);</div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span> Process_(DspSignalBus&amp; inputs, DspSignalBus&amp; outputs);</div>
<div class="line"><span class="keyword">private</span>:  </div>
<div class="line">  <span class="keywordtype">bool</span> ParameterUpdating_(<span class="keywordtype">int</span> index, <span class="keyword">const</span> DspParameter&amp; param);</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">}} <span class="comment">//namespace openlf::components</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><h3>Explanation</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef _OPENLF_COMP_TUTORIAL_H</span></div>
<div class="line"><span class="preprocessor">#define _OPENLF_COMP_TUTORIAL_H</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;dspatch/DspComponent.h&quot;</span></div>
</div><!-- fragment --><p> Standard include guard and required header.</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceopenlf.html">openlf</a> { <span class="keyword">namespace </span>components {</div>
</div><!-- fragment --><p> All components should go into openlf::components.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>COMP_Tutorial : <span class="keyword">public</span> DspComponent {</div>
</div><!-- fragment --><p> To create a new component we always derive from DspComponent.</p>
<div class="fragment"><div class="line">COMP_Tutorial();</div>
</div><!-- fragment --><p> Our constructor.</p>
<div class="fragment"><div class="line">DSPCOMPONENT_TRIVIAL_CLONE(COMP_Tutorial);</div>
</div><!-- fragment --><p> This is a macro which implements <em>::clone()</em> by creating a new instance with <b>new</b> and then applies all parameters to the new instance. This should be sufficient for almost all cases. Clone is used by <a class="el" href="classOpenLF.html">OpenLF</a> to implement threading, as well as by the GUI to interactively add new components.</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> Process_(DspSignalBus&amp; inputs, DspSignalBus&amp; outputs);</div>
</div><!-- fragment --><p> This method will implement the actual processing.</p>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> ParameterUpdating_(<span class="keywordtype">int</span> index, <span class="keyword">const</span> DspParameter&amp; param);</div>
</div><!-- fragment --><p> This method will be called when parameters are changed.</p>
<h2>Implementation</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;comp_tutorial.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="types_8hpp.html">types.hpp</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span>clif;</div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceopenlf.html">openlf</a> { <span class="keyword">namespace </span>components {</div>
<div class="line"></div>
<div class="line">COMP_Tutorial::COMP_Tutorial()</div>
<div class="line">{</div>
<div class="line">  setTypeName_(<span class="stringliteral">&quot;tutorial&quot;</span>);</div>
<div class="line">  AddInput_(<span class="stringliteral">&quot;input&quot;</span>);</div>
<div class="line">  AddOutput_(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line"></div>
<div class="line">  AddParameter_(<span class="stringliteral">&quot;path&quot;</span>, DspParameter(DspParameter::ParamType::String));</div>
<div class="line">  AddParameter_(<span class="stringliteral">&quot;message&quot;</span>, DspParameter(DspParameter::ParamType::String));</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> COMP_Tutorial::Process_(DspSignalBus&amp; inputs, DspSignalBus&amp; outputs)</div>
<div class="line">{</div>
<div class="line">  LF *in = NULL;</div>
<div class="line">  LF *out = NULL;</div>
<div class="line">  <span class="keyword">const</span> std::string *path;</div>
<div class="line">  <span class="keyword">const</span> std::string *message;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//get input and produce error if not available</span></div>
<div class="line">  errorCond(inputs.GetValue(0, in)); RETURN_ON_ERROR</div>
<div class="line"></div>
<div class="line">  <span class="comment">//get settings</span></div>
<div class="line">  path = GetParameter(0)-&gt;GetString();</div>
<div class="line">  message = GetParameter(1)-&gt;GetString();</div>
<div class="line"></div>
<div class="line">  <span class="comment">//check for errors</span></div>
<div class="line">  errorCond(path); RETURN_ON_ERROR</div>
<div class="line">  errorCond(message); RETURN_ON_ERROR</div>
<div class="line"></div>
<div class="line">  <span class="comment">//create output LF dataset by linking input</span></div>
<div class="line">  out = <span class="keyword">new</span> LF();</div>
<div class="line">  out-&gt;data = <span class="keyword">new</span> Dataset();</div>
<div class="line">  out-&gt;data-&gt;memory_link(in-&gt;data);</div>
<div class="line">  outputs.SetValue(0, out);</div>
<div class="line"></div>
<div class="line">  <span class="comment">//skip actual processing</span></div>
<div class="line">  <span class="keywordflow">if</span> (configOnly())</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//create attribute for path</span></div>
<div class="line">  Attribute attr(*path);</div>
<div class="line">  <span class="comment">//set message</span></div>
<div class="line">  attr.set(message-&gt;c_str());</div>
<div class="line">  <span class="comment">//append to output dataset</span></div>
<div class="line">  out-&gt;data-&gt;append(attr);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> COMP_Tutorial::ParameterUpdating_(<span class="keywordtype">int</span> index, <span class="keyword">const</span> DspParameter&amp; param)</div>
<div class="line">{  </div>
<div class="line">  <span class="comment">//just store parameter </span></div>
<div class="line">  <span class="keywordflow">return</span> SetParameter_(index, param);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">}} <span class="comment">//namespace openlf::components</span></div>
</div><!-- fragment --><h3>Explanation</h3>
<div class="fragment"><div class="line">COMP_Tutorial::COMP_Tutorial()</div>
<div class="line">{</div>
<div class="line">  setTypeName_(<span class="stringliteral">&quot;tutorial&quot;</span>);</div>
<div class="line">  AddInput_(<span class="stringliteral">&quot;input&quot;</span>);</div>
<div class="line">  AddOutput_(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line"></div>
<div class="line">  AddParameter_(<span class="stringliteral">&quot;path&quot;</span>, DspParameter(DspParameter::ParamType::String));</div>
<div class="line">  AddParameter_(<span class="stringliteral">&quot;message&quot;</span>, DspParameter(DspParameter::ParamType::String));</div>
<div class="line">}</div>
</div><!-- fragment --><p> This is the constructor. The only mandatory part is <em>setTypeName()</em>, which will be used display our new component and identify it when storing circuits. Inputs and outputs are added with <em>AddInput_()</em>, <em>AddOutput_()</em> respectively, add as many inputs and outputs as desired. <em>AddParameter_()</em> adds a new Paramter and specifies the type. You can also pass default values by using for example: <code>DspParameter(DspParameter::ParamType::Int, 17)</code>.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> COMP_Tutorial::Process_(DspSignalBus&amp; inputs, DspSignalBus&amp; outputs)</div>
<div class="line">{</div>
<div class="line">  LF *in = NULL;</div>
<div class="line">  LF *out = NULL;</div>
<div class="line">  <span class="keyword">const</span> std::string *path;</div>
<div class="line">  <span class="keyword">const</span> std::string *message;</div>
</div><!-- fragment --><p> This marks the begin of our actual component implementation. <em>inputs</em> and <em>outputs</em> contain the input and output signals which are connected to different components. <em>LF</em> contains an actual clif::Dataset and an optional string to specify some component of the dataset.</p>
<div class="fragment"><div class="line"><span class="comment">//get input and produce error if not available</span></div>
<div class="line">errorCond(inputs.GetValue(0, in)); RETURN_ON_ERROR</div>
</div><!-- fragment --><p> <em>inputs.GetValue(0, in)</em> reads the first input into <em>in</em> if <em>in</em> is of the same type as got passed from the connected component. If <em>GetValue()</em> is successfull true is return, else false.</p>
<p><em>errorCond()</em> provides error checking by setting an error on our component if the passed condition is false. You can also pass an error message as second parameter which can be displayed by the GUI. The error state can be checked with <em>hasError()</em>.</p>
<p>Components can be executed in two modes, the method configOnly() shows wether this is only a configuration run or the actual execution. Config runs are used to find and display errors prior to actual execution, therefore only simple error checking and parameter passing should be executed if <em>configOnly()</em> returns true.</p>
<p><em>RETURN_ON_ERROR</em> combines error checking with the config state and simply returns from the caller if there is an error in a config run, and aborts if an error is detected in actual execution. This macro should always be used, as it will later implement more advanced error handling.</p>
<div class="fragment"><div class="line"><span class="comment">//get settings</span></div>
<div class="line">path = GetParameter(0)-&gt;GetString();</div>
<div class="line">message = GetParameter(1)-&gt;GetString();</div>
<div class="line"></div>
<div class="line"><span class="comment">//check for errors</span></div>
<div class="line">errorCond(path); RETURN_ON_ERROR</div>
<div class="line">errorCond(message); RETURN_ON_ERROR</div>
</div><!-- fragment --><p> Get parameters and check for errors again.</p>
<div class="fragment"><div class="line"><span class="comment">//create output LF dataset by linking input</span></div>
<div class="line">out = <span class="keyword">new</span> LF();</div>
<div class="line">out-&gt;data = <span class="keyword">new</span> Dataset();</div>
<div class="line">out-&gt;data-&gt;memory_link(in-&gt;data);</div>
<div class="line">outputs.SetValue(0, out);</div>
</div><!-- fragment --><p> Create our output and store it in outpus using <em>SetValue()</em>. <em>memory_link</em> will create a shallow copy of the dataset in memory. Only newly added elements will actually be stored in the dataset, all others will be linked from the original dataset. This is also partly true if the dataset is stored on disk again. In that case soft links within the hdf5 file are used to reference the original data, though this is true only for all hdf5 datasets (= clif::Datastore) within the file, all attributes are actually copied.</p>
<div class="fragment"><div class="line"><span class="comment">//skip actual processing</span></div>
<div class="line"><span class="keywordflow">if</span> (configOnly())</div>
<div class="line">  <span class="keywordflow">return</span>;</div>
</div><!-- fragment --><p> We are now finished with the preparations, if we are in config mode we return now to skip any actual processing.</p>
<div class="fragment"><div class="line">  <span class="comment">//create attribute for path</span></div>
<div class="line">  Attribute attr(*path);</div>
<div class="line">  <span class="comment">//set message</span></div>
<div class="line">  attr.set(message-&gt;c_str());</div>
<div class="line">  <span class="comment">//append to output dataset</span></div>
<div class="line">  out-&gt;data-&gt;append(attr);</div>
<div class="line">}</div>
</div><!-- fragment --><p> This is the code which represents our (quite heavy) processing. We simply create a new <em>clif::Attribute</em> for the specified path, store our message and append the attribute to our dataset.</p>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> COMP_Tutorial::ParameterUpdating_(<span class="keywordtype">int</span> index, <span class="keyword">const</span> DspParameter&amp; param)</div>
<div class="line">{  </div>
<div class="line">  <span class="comment">//just store parameter </span></div>
<div class="line">  <span class="keywordflow">return</span> SetParameter_(index, param);</div>
<div class="line">}</div>
</div><!-- fragment --><p> This method must be implemented if we need any parameters. This implementation simply passes through the parameter, if desired more complex checks can be implemented checking parameter type and content and returning false when problems are found.</p>
<h3>Build</h3>
<p>We will now add the component to the build system:</p><ul>
<li>Store the header in in <em>include/openlf/components/</em> for example as <em>comp_tutorial.hpp</em> and the implementation in <em>src/components/</em>.</li>
<li>add the implementation to the list in src/components/CMakeLists.txt, so it will actually be compiled</li>
<li>in <em><a class="el" href="openlf_8hpp.html">include/openlf.hpp</a></em> add our new header to the long list of includes at the top and our new component to the global <em>_comp_list</em>.</li>
<li>rebuild the project and test the new component with the LF_Toolbox! </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Nov 23 2015 13:59:18 for OpenLF by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
